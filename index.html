<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - TheRolfFR/firestorm-db: Self hosted Firestore-like database</title>
    
    <meta name="description" content="Self hosted Firestore-like database with API endpoints based on micro bulk operations" />
    
        <meta name="keywords" content="firebase,firestore,db,api,php,micro-operations,bulk" />
        <meta name="keyword" content="firebase,firestore,db,api,php,micro-operations,bulk" />
    
    
    
    <meta property="og:title" content="TheRolfFR/firestorm-db: Self hosted Firestore-like database"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://github.com/TheRolfFR/firestorm-db/raw/main/img/firestorm-512.png"/>
    <meta property="og:site_name" content="firestorm-db"/>
    <meta property="og:url" content="https://github.com/TheRolfFR/firestorm-db/"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/TheRolfFR/firestorm" target="_blank" class="menu-item" id="repository" >Repository</a></h2><h2><a href="https://www.npmjs.com/package/firestorm-db" target="_blank" class="menu-item" id="npm" >npm</a></h2><h3>Classes</h3><ul><li><a href="Collection.html">Collection</a><ul class='methods'><li data-type='method'><a href="Collection.html#add">add</a></li><li data-type='method'><a href="Collection.html#addBulk">addBulk</a></li><li data-type='method'><a href="Collection.html#editField">editField</a></li><li data-type='method'><a href="Collection.html#editFieldBulk">editFieldBulk</a></li><li data-type='method'><a href="Collection.html#get">get</a></li><li data-type='method'><a href="Collection.html#random">random</a></li><li data-type='method'><a href="Collection.html#read_raw">read_raw</a></li><li data-type='method'><a href="Collection.html#readRaw">readRaw</a></li><li data-type='method'><a href="Collection.html#remove">remove</a></li><li data-type='method'><a href="Collection.html#removeBulk">removeBulk</a></li><li data-type='method'><a href="Collection.html#search">search</a></li><li data-type='method'><a href="Collection.html#searchKeys">searchKeys</a></li><li data-type='method'><a href="Collection.html#select">select</a></li><li data-type='method'><a href="Collection.html#set">set</a></li><li data-type='method'><a href="Collection.html#setBulk">setBulk</a></li><li data-type='method'><a href="Collection.html#sha1">sha1</a></li><li data-type='method'><a href="Collection.html#values">values</a></li><li data-type='method'><a href="Collection.html#write_raw">write_raw</a></li><li data-type='method'><a href="Collection.html#writeRaw">writeRaw</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="firestorm.html">firestorm</a><ul class='members'><li data-type='member'><a href="firestorm.html#.ID_FIELD">ID_FIELD</a></li></ul><ul class='methods'><li data-type='method'><a href="firestorm.html#.address">address</a></li><li data-type='method'><a href="firestorm.html#.collection">collection</a></li><li data-type='method'><a href="firestorm.html#.table">table</a></li><li data-type='method'><a href="firestorm.html#.token">token</a></li></ul></li><li><a href="firestorm.files.html">firestorm.files</a><ul class='methods'><li data-type='method'><a href="firestorm.files.html#.delete">delete</a></li><li data-type='method'><a href="firestorm.files.html#.get">get</a></li><li data-type='method'><a href="firestorm.files.html#.upload">upload</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
    
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><div align="center">
<img src="img/firestorm-128.png">
<h1>firestorm-db</h1>
<a href="https://www.npmjs.com/package/firestorm-db" target="_blank">
    <img alt="npm" src="https://img.shields.io/npm/v/firestorm-db?color=cb0000&logo=npm&style=flat-square">
</a>
<img alt="GitHub file size in bytes" src="https://img.shields.io/github/size/TheRolfFR/firestorm-db/src%2Findex.js?color=43A047&label=Script%20size&logoColor=green&style=flat-square">
<a href="https://github.com/TheRolfFR/firestorm-db/blob/main/CHANGELOG.md">
    <img alt="Changelog" src="https://img.shields.io/badge/Changelog-Read_here-blue?style=flat-square">
</a>
<a href="https://github.com/TheRolfFR/firestorm-db/actions/workflows/testjs.yml">
    <img src="https://img.shields.io/github/actions/workflow/status/TheRolfFR/firestorm-db/testjs.yml?style=flat-square" alt="Tests" />
</a>
</div>
<p><em>Self hosted Firestore-like database with API endpoints based on micro bulk operations</em></p>
<h1>Installation</h1>
<p>Installing the JavaScript client is as simple as running:</p>
<pre class="prettyprint source lang-sh"><code>npm install firestorm-db
</code></pre>
<p>Information about installing Firestorm server-side is given in the <a href="#php-backend">PHP</a> section.</p>
<h1>JavaScript Client</h1>
<p>The JavaScript <a href="./src/index.js">index.js</a> file is simply an <a href="https://www.npmjs.com/package/axios">Axios</a> wrapper of the PHP backend.</p>
<h2>JavaScript setup</h2>
<p>First, set your API address (and your writing token if needed) using the <code>address()</code> and <code>token()</code> functions:</p>
<pre class="prettyprint source lang-js"><code>// only needed in Node.js, including the script tag in a browser is enough otherwise.
const firestorm = require(&quot;firestorm-db&quot;);

firestorm.address(&quot;http://example.com/path/to/firestorm/root/&quot;);

// only necessary if you want to write or access private collections
// must match token stored in tokens.php file
firestorm.token(&quot;my_secret_token_probably_from_an_env_file&quot;);
</code></pre>
<p>Now you can use Firestorm to its full potential.</p>
<h2>Create your first collection</h2>
<p>Firestorm is based around the concept of a <code>Collection</code>, which is akin to an SQL table or Firestore document. The Firestorm collection constructor takes one required argument and one optional argument:</p>
<ul>
<li>The name of the collection as a <code>string</code>.</li>
<li>A method adder, which lets you inject methods to query results. It's implemented similarly to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map"><code>Array.prototype.map</code></a>, taking a queried element as an argument, modifying the element with methods and data inside a callback, and returning the modified element at the end.</li>
</ul>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);

const userCollection = firestorm.collection(&quot;users&quot;, (el) => {
    // assumes you have a 'users' table with a printable field called 'name'
    el.hello = () => `${el.name} says hello!`;
    // return the modified element back with the injected method
    return el;
});

// all methods return promises
const johnDoe = await userCollection.get(123456789);
// gives { name: &quot;John Doe&quot;, hello: Function }

johnDoe.hello(); // &quot;John Doe says hello!&quot;
</code></pre>
<h2>Read operations</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sha1()</td>
<td>none</td>
<td>Get the sha1 hash of the file. Can be used to compare file content without downloading the JSON.</td>
</tr>
<tr>
<td>readRaw(original)</td>
<td>original?: <code>boolean</code></td>
<td>Read the entire collection. <code>original</code> disables ID field injection, for non-relational collections.</td>
</tr>
<tr>
<td>get(key)</td>
<td>key: <code>string \| number</code></td>
<td>Get an element from the collection by its key.</td>
</tr>
<tr>
<td>searchKeys(keys)</td>
<td>keys: <code>string[] \| number[]</code></td>
<td>Get multiple elements from the collection by their keys.</td>
</tr>
<tr>
<td>search(options, random)</td>
<td>options: <code>SearchOption[]</code> random?:<code>boolean \| number</code></td>
<td>Search through the collection. You can randomize the output order with random as true or a given seed.</td>
</tr>
<tr>
<td>select(option)</td>
<td>option: <code>SelectOption</code></td>
<td>Get only selected fields from the collection. Essentially an upgraded version of readRaw.</td>
</tr>
<tr>
<td>values(option)</td>
<td>option: <code>ValueOption</code></td>
<td>Get all distinct non-null values for a given key across a collection.</td>
</tr>
<tr>
<td>random(max, seed, offset)</td>
<td>max?: <code>number &gt;= -1</code> seed?: <code>number</code> offset?: <code>number &gt;= 0</code></td>
<td>Read random elements of the collection.</td>
</tr>
</tbody>
</table>
<h2>Search options</h2>
<p>There are more options available than the Firestore <code>where</code> command, allowing you to get better and faster search results.</p>
<p>The search method can take one or more options to filter entries in a collection. A search option takes a <code>field</code> with a <code>criteria</code> and compares it to a <code>value</code>. You can also use the boolean <code>ignoreCase</code> option for string values. Available criteria depends on the field type.</p>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Types allowed</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'!='</code></td>
<td><code>boolean</code>, <code>number</code>, <code>string</code></td>
<td>Entry field's value is different from yours</td>
</tr>
<tr>
<td><code>'=='</code></td>
<td><code>boolean</code>, <code>number</code>, <code>string</code></td>
<td>Entry field's value is equal to yours</td>
</tr>
<tr>
<td><code>'&gt;='</code></td>
<td><code>number</code>, <code>string</code></td>
<td>Entry field's value is greater or equal than yours</td>
</tr>
<tr>
<td><code>'&lt;='</code></td>
<td><code>number</code>, <code>string</code></td>
<td>Entry field's value is equal to than yours</td>
</tr>
<tr>
<td><code>'&gt;'</code></td>
<td><code>number</code>, <code>string</code></td>
<td>Entry field's value is greater than yours</td>
</tr>
<tr>
<td><code>'&lt;'</code></td>
<td><code>number</code>, <code>string</code></td>
<td>Entry field's value is lower than yours</td>
</tr>
<tr>
<td><code>'in'</code></td>
<td><code>number</code>, <code>string</code></td>
<td>Entry field's value is in the array of values you gave</td>
</tr>
<tr>
<td><code>'includes'</code></td>
<td><code>string</code></td>
<td>Entry field's value includes your substring</td>
</tr>
<tr>
<td><code>'startsWith'</code></td>
<td><code>string</code></td>
<td>Entry field's value starts with your substring</td>
</tr>
<tr>
<td><code>'endsWith'</code></td>
<td><code>string</code></td>
<td>Entry field's value ends with your substring</td>
</tr>
<tr>
<td><code>'array-contains'</code></td>
<td><code>Array</code></td>
<td>Entry field's array contains your value</td>
</tr>
<tr>
<td><code>'array-contains-none'</code></td>
<td><code>Array</code></td>
<td>Entry field's array contains no values from your array</td>
</tr>
<tr>
<td><code>'array-contains-any'</code></td>
<td><code>Array</code></td>
<td>Entry field's array contains at least one value from your array</td>
</tr>
<tr>
<td><code>'array-length-eq'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is equal to your value</td>
</tr>
<tr>
<td><code>'array-length-df'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is different from your value</td>
</tr>
<tr>
<td><code>'array-length-lt'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is lower than your value</td>
</tr>
<tr>
<td><code>'array-length-gt'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is greater than your value</td>
</tr>
<tr>
<td><code>'array-length-le'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is lower or equal to your value</td>
</tr>
<tr>
<td><code>'array-length-ge'</code></td>
<td><code>number</code></td>
<td>Entry field's array size is greater or equal to your value</td>
</tr>
</tbody>
</table>
<h2>Write operations</h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>writeRaw(value)</td>
<td>value: <code>Object</code></td>
<td>Set the entire content of the collection. <strong>⚠️ Very dangerous! ⚠️</strong></td>
</tr>
<tr>
<td>add(value)</td>
<td>value: <code>Object</code></td>
<td>Append a value to the collection. Only works if <code>autoKey</code> is enabled server-side.</td>
</tr>
<tr>
<td>addBulk(values)</td>
<td>values: <code>Object[]</code></td>
<td>Append multiple values to the collection. Only works if <code>autoKey</code> is enabled server-side.</td>
</tr>
<tr>
<td>remove(key)</td>
<td>key: <code>string \| number</code></td>
<td>Remove an element from the collection by its key.</td>
</tr>
<tr>
<td>removeBulk(keys)</td>
<td>keys: <code>string[] \| number[]</code></td>
<td>Remove multiple elements from the collection by their keys.</td>
</tr>
<tr>
<td>set(key, value)</td>
<td>key: <code>string \| number</code>, value: <code>Object</code></td>
<td>Set a value in the collection by its key.</td>
</tr>
<tr>
<td>setBulk(keys, values)</td>
<td>keys: <code>string[] \| number[]</code>, values: <code>Object[]</code></td>
<td>Set multiple values in the collection by their keys.</td>
</tr>
<tr>
<td>editField(obj)</td>
<td>option: <code>EditFieldOption</code></td>
<td>Edit an element's field in the collection.</td>
</tr>
<tr>
<td>editFieldBulk(objArray)</td>
<td>options: <code>EditFieldOption[]</code></td>
<td>Edit multiple elements' fields in the collection.</td>
</tr>
</tbody>
</table>
<h2>Edit field options</h2>
<p>Edit objects have an <code>id</code> of the element, a <code>field</code> to edit, an <code>operation</code> with what to do to this field, and a possible <code>value</code>. Here is a list of operations:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Needs value</th>
<th>Allowed value types</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>set</code></td>
<td>Yes</td>
<td><code>any</code></td>
<td>Sets a value to a given field.</td>
</tr>
<tr>
<td><code>remove</code></td>
<td>No</td>
<td><em>N/A</em></td>
<td>Removes a field from the element.</td>
</tr>
<tr>
<td><code>append</code></td>
<td>Yes</td>
<td><code>string</code></td>
<td>Appends a string to the end of a string field.</td>
</tr>
<tr>
<td><code>invert</code></td>
<td>No</td>
<td><em>N/A</em></td>
<td>Inverts the state of a boolean field.</td>
</tr>
<tr>
<td><code>increment</code></td>
<td>No</td>
<td><code>number</code></td>
<td>Adds a number to the field (default: 1).</td>
</tr>
<tr>
<td><code>decrement</code></td>
<td>No</td>
<td><code>number</code></td>
<td>Removes a number from the field (default: 1).</td>
</tr>
<tr>
<td><code>array-push </code></td>
<td>Yes</td>
<td><code>any</code></td>
<td>Pushes an element to the end of an array field.</td>
</tr>
<tr>
<td><code>array-delete</code></td>
<td>Yes</td>
<td><code>number</code></td>
<td>Removes an array element by index.</td>
</tr>
<tr>
<td><code>array-splice</code></td>
<td>Yes</td>
<td><code>[number, number, any?]</code></td>
<td>Last argument is optional. Check the PHP <a href="https://www.php.net/manual/function.array-splice">array_splice</a> documentation for more info.</td>
</tr>
</tbody>
</table>
<p>Various other methods and constants exist in the JavaScript client, which will make more sense once you learn what's actually happening behind the scenes.</p>
<h1>PHP Backend</h1>
<p>Firestorm's PHP files handle files, read, and writes, through <code>GET</code> and <code>POST</code> requests sent by the JavaScript client. All JavaScript methods correspond to an equivalent Axios request to the relevant PHP file.</p>
<h2>PHP setup</h2>
<p>The server-side files to handle requests can be found and copied to your hosting platform <a href="./php/">here</a>. The two files that need editing are <code>tokens.php</code> and <code>config.php</code>.</p>
<ul>
<li><code>tokens.php</code> contains writing tokens declared in a <code>$db_tokens</code> array. These correspond to the tokens used with <code>firestorm.token()</code> in the JavaScript client.</li>
<li><code>config.php</code> stores all of your collections. This file needs to declare a <code>$database_list</code> associative array of <code>JSONDatabase</code> instances.</li>
</ul>
<pre class="prettyprint source lang-php"><code>&lt;?php
// config.php
require_once './classes/JSONDatabase.php';

$database_list = array();

// without constructor
$tmp = new JSONDatabase;
$tmp->folderPath = './files/';
$tmp->fileName = 'orders';
$tmp->autoKey = true;
$tmp->autoIncrement = false;

$database_list[$tmp->fileName] = $tmp;

// with constructor ($fileName, $autoKey = true, $autoIncrement = true)
$tmp = new JSONDatabase('users', false);
$tmp->folderPath = './files/';

$database_list[$tmp->fileName] = $tmp;
</code></pre>
<ul>
<li>The database will be stored in <code>&lt;folderPath&gt;/&lt;filename&gt;.json</code> (default folder: <code>./files/</code>).</li>
<li><code>autoKey</code> controls whether to automatically generate the key name or to have explicit key names (default: <code>true</code>).</li>
<li><code>autoIncrement</code> controls whether to simply start generating key names from zero or to use a <a href="https://www.php.net/manual/en/function.uniqid.php">random ID</a> each time (default: <code>true</code>).</li>
<li>The key in the <code>$database_list</code> array is what the collection should be referred to in the JavaScript collection constructor. This can be different from the JSON filename if needed.</li>
</ul>
<p>If you're working with multiple collections, it's probably easier to initialize them all in the array constructor directly:</p>
<pre class="prettyprint source lang-php"><code>// config.php
&lt;?php
require_once './classes/JSONDatabase.php';
$database_list = array(
    'orders' => new JSONDatabase('orders', true),
    'users' => new JSONDatabase('users', false),
)
</code></pre>
<h2>Permissions</h2>
<p>The PHP scripts used to write and read files need permissions to edit the JSON files. You can give Firestorm rights to a folder with the following command:</p>
<pre class="prettyprint source lang-sh"><code>sudo chown -R www-data &quot;/path/to/firestorm/root/&quot;
</code></pre>
<h1>Firestorm Files</h1>
<p>Firestorm's file APIs are implemented in <code>files.php</code>. If you don't need file-related features, then simply delete this file.</p>
<p>To work with files server-side, you need two new configuration variables in <code>config.php</code>:</p>
<pre class="prettyprint source lang-php"><code>// Extension whitelist
$authorized_file_extension = array('.txt', '.png', '.jpg', '.jpeg');

// Root directory for where files should be uploaded
// ($_SERVER['SCRIPT_FILENAME']) is a shortcut to the root Firestorm directory.
$STORAGE_LOCATION = dirname($_SERVER['SCRIPT_FILENAME']) . '/uploads/';
</code></pre>
<p>From there, you can use the functions in <code>firestorm.files</code> (detailed below) from the JavaScript client.</p>
<h2>Upload a file</h2>
<p><code>firestorm.files.upload</code> uses a <code>FormData</code> object to represent an uploaded file. This class is generated from forms and is <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData">native in modern browsers</a>, and with Node.js can be installed with the <a href="https://www.npmjs.com/package/form-data">form-data</a> package.</p>
<p>The uploaded file content can be a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">String</a>, a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a>, a <a href="https://nodejs.org/api/buffer.html">Buffer</a>, or an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a>.</p>
<p>There is additionally an overwrite option in order to avoid mistakes.</p>
<pre class="prettyprint source lang-js"><code>const FormData = require(&quot;form-data&quot;);
const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);
firestorm.token(&quot;TOKEN_VALUE&quot;);

const form = new FormData();
form.append(&quot;path&quot;, &quot;/quote.txt&quot;);
// make sure to set a temporary file name
form.append(&quot;file&quot;, &quot;but your kids are gonna love it.&quot;, &quot;quote.txt&quot;);
// override is false by default; don't append it if you don't need to
form.append(&quot;overwrite&quot;, &quot;true&quot;);

const uploadPromise = firestorm.files.upload(form);

uploadPromise
    .then(() => console.log(&quot;Upload successful&quot;))
    .catch((err) => console.error(err));
</code></pre>
<h2>Get a file</h2>
<p><code>firestorm.files.get</code> takes a file's direct URL location or its content as its parameter. If your upload folder is accessible from a server URL, you can directly use its address to retrieve the file without this method.</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);

const getPromise = firestorm.files.get(&quot;/quote.txt&quot;);

getPromise
    .then((fileContent) => console.log(fileContent)) // but your kids are gonna love it.
    .catch((err) => console.error(err));
</code></pre>
<h2>Delete a file</h2>
<p><code>firestorm.files.delete</code> has the same interface as <code>firestorm.files.get</code>, but as the name suggests, it deletes the file.</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);
firestorm.token(&quot;TOKEN_VALUE&quot;);

const deletePromise = firestorm.files.delete(&quot;/quote.txt&quot;);

deletePromise
    .then(() => console.log(&quot;File successfully deleted&quot;))
    .catch((err) => console.error(err));
</code></pre>
<h1>TypeScript Support</h1>
<p>Firestorm ships with TypeScript support out of the box.</p>
<h2>Collection types</h2>
<p>Collections in TypeScript take a generic parameter <code>T</code>, which is the type of each element in the collection. If you aren't using a relational collection, this can simply be set to <code>any</code>.</p>
<pre class="prettyprint source lang-ts"><code>import firestorm from &quot;firestorm-db&quot;;
firestorm.address(&quot;ADDRESS_VALUE&quot;);

interface User {
    name: string;
    password: string;
    pets: string[];
}

const userCollection = firestorm.collection&lt;User>(&quot;users&quot;);

const johnDoe = await userCollection.get(123456789);
// type: { name: string, password: string, pets: string[] }
</code></pre>
<p>Injected methods should also be stored in this interface. They'll get filtered out from write operations to prevent false positives:</p>
<pre class="prettyprint source lang-ts"><code>import firestorm from &quot;firestorm-db&quot;;
firestorm.address(&quot;ADDRESS_VALUE&quot;);

interface User {
    name: string;
    hello(): string;
}

const userCollection = firestorm.collection(&quot;users&quot;, (el) => {
    // interface types should agree with injected methods
    el.hello = () => `${el.name} says hello!`;
    return el;
});

const johnDoe = await userCollection.get(123456789);
const hello = johnDoe.hello(); // type: string

await userCollection.add({
    name: &quot;Mary Doe&quot;,
    // error: 'hello' does not exist in type 'Addable&lt;User>'.
    hello() {
        return &quot;Mary Doe says hello!&quot;
    }
})
</code></pre>
<h2>Additional types</h2>
<p>Additional types exist for search criteria options, write method return types, configuration methods, the file handler, etc.</p>
<pre class="prettyprint source lang-ts"><code>import firestorm from &quot;firestorm-db&quot;;
const address = firestorm.address(&quot;ADDRESS_VALUE&quot;);
// type: string

const deleteConfirmation = await firestorm.files.delete(&quot;/quote.txt&quot;);
// type: firestorm.WriteConfirmation
</code></pre>
<h1>Advanced Features</h1>
<h2><code>ID_FIELD</code> and its meaning</h2>
<p>There's a constant in Firestorm called <code>ID_FIELD</code>, which is a JavaScript-side property added afterwards to each query element.</p>
<p>Its value will always be the key of the element its in, which allows you to use <code>Object.values</code> on results without worrying about losing the elements' key names. Additionally, it can be used in the method adder in the constructor, and is convenient for collections where the key name is significant.</p>
<pre class="prettyprint source lang-js"><code>const userCollection = firestorm.collection(&quot;users&quot;, (el) => {
    el.basicInfo = () => `${el.name} (${el[firestorm.ID_FIELD]})`;
    return el;
});

const returnedID = await userCollection.add({ name: &quot;Bob&quot;, age: 30 });
const returnedUser = await userCollection.get(returnedID);

console.log(returnedID === returnedUser[firestorm.ID_FIELD]); // true

returnedUser.basicInfo(); // Bob (123456789)
</code></pre>
<p>As it's entirely a JavaScript construct, <code>ID_FIELD</code> values will never be in your collection.</p>
<h2>Add and set operations</h2>
<p>You may have noticed two different methods that seem to do the same thing: <code>add</code> and <code>set</code> (and their corresponding bulk variants). The key difference is that <code>add</code> is used on collections where <code>autoKey</code> is enabled, and <code>set</code> is used on collections where <code>autoKey</code> is disabled. <code>autoIncrement</code> doesn't affect this behavior.</p>
<p>For instance, the following PHP configuration will disable add operations:</p>
<pre class="prettyprint source lang-php"><code>$database_list['users'] = new JSONDatabase('users', false);
</code></pre>
<pre class="prettyprint source lang-js"><code>const userCollection = firestorm.collection(&quot;users&quot;);
// Error: Automatic key generation is disabled
await userCollection.add({ name: &quot;John Doe&quot;, age: 30 });
</code></pre>
<p>Add operations return the generated ID of the added element, since it isn't known at add time, but set operations simply return a confirmation. If you want to get an element after it's been set, use the ID passed into the method.</p>
<pre class="prettyprint source lang-js"><code>// this will not work, since set operations don't return the ID
userCollection.set(123, { name: &quot;John Doe&quot;, age: 30 })
    .then((id) => userCollection.get(id));
</code></pre>
<h2>Combining collections</h2>
<p>Using add methods in the constructor, you can link multiple collections together.</p>
<pre class="prettyprint source lang-js"><code>const orders = firestorm.collection(&quot;orders&quot;);

// using the example of a customer having orders
const customers = firestorm.collection(&quot;customers&quot;, (el) => {
    el.getOrders = () => orders.search([
        {
            field: &quot;customer&quot;,
            criteria: &quot;==&quot;,
            // assuming the customers field in the orders collection is a user ID
            value: el[firestorm.ID_FIELD]
        }
    ])
    return el;
})

const johnDoe = await customers.get(123456789);

// returns orders where the customer field is John Doe's ID
await johnDoe.getOrders();
</code></pre>
<p>This functionality is particularly useful for complex data hierarchies that store fields as ID values to other collections, and is the main reason why add methods exist in the first place. It can also be used to split deeply nested data structures to increase server-side performance by only loading collections when necessary.</p>
<h2>Manually sending data</h2>
<p>Each operation type requests a different file. In the JavaScript client, the corresponding file gets appended onto your base Firestorm address.</p>
<ul>
<li>Read requests are <code>GET</code> requests sent to <code>&lt;your_address_here&gt;/get.php</code>.</li>
<li>Write requests are <code>POST</code> requests sent to <code>&lt;your_address_here&gt;/post.php</code> with JSON data.</li>
<li>File requests are sent to <code>&lt;your_address_here&gt;/files.php</code> with form data.</li>
</ul>
<p>The first keys in a Firestorm request will always be the same regardless of its type, and further keys will depend on the specific method:</p>
<pre class="prettyprint source lang-json"><code>{
    &quot;collection&quot;: &quot;&lt;collectionName>&quot;,
    &quot;token&quot;: &quot;&lt;writeTokenIfNecessary>&quot;,
    &quot;command&quot;: &quot;&lt;methodName>&quot;,
    ...
}
</code></pre>
<p>PHP grabs the <code>JSONDatabase</code> instance created in <code>config.php</code> using the <code>collection</code> key in the request as the <code>$database_list</code> key name. From there, the <code>token</code> is used to validate the request if needed and the <code>command</code> is found and executed.</p>
<h2>Memory management</h2>
<p>Handling very large collections can cause memory allocation issues:</p>
<pre class="prettyprint source"><code>Fatal error:
Allowed memory size of 134217728 bytes exhausted (tried to allocate 32360168 bytes)
</code></pre>
<p>If you encounter a memory allocation issue, simply change the memory limit in <code>/etc/php/7.4/apache2/php.ini</code> to be bigger:</p>
<pre class="prettyprint source"><code>memory_limit = 256M
</code></pre>
<p>If this doesn't help, considering splitting your collection into smaller collections and linking them together with methods.</p></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Thu May 09 2024 18:36:13 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>