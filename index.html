<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - TheRolfFR/firestorm-db: Self hosted Firestore-like database</title>
    
    <meta name="description" content="Self hosted Firestore-like database with API endpoints based on micro bulk operations" />
    
        <meta name="keywords" content="firebase,firestore,db,api,php,micro-operations,bulk" />
        <meta name="keyword" content="firebase,firestore,db,api,php,micro-operations,bulk" />
    
    
    
    <meta property="og:title" content="TheRolfFR/firestorm-db: Self hosted Firestore-like database"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://github.com/TheRolfFR/firestorm-db/raw/main/img/firestorm-512.png"/>
    <meta property="og:site_name" content="firestorm-db"/>
    <meta property="og:url" content="https://github.com/TheRolfFR/firestorm-db/"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav class="wrap">
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/TheRolfFR/firestorm" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h2><a href="https://www.npmjs.com/package/firestorm-db" target="_blank" class="menu-item" id="npm" >npm</a></h2><h3>Classes</h3><ul><li><a href="Collection.html">Collection</a><ul class='methods'><li data-type='method'><a href="Collection.html#add">add</a></li><li data-type='method'><a href="Collection.html#addBulk">addBulk</a></li><li data-type='method'><a href="Collection.html#editField">editField</a></li><li data-type='method'><a href="Collection.html#editFieldBulk">editFieldBulk</a></li><li data-type='method'><a href="Collection.html#get">get</a></li><li data-type='method'><a href="Collection.html#random">random</a></li><li data-type='method'><a href="Collection.html#read_raw">read_raw</a></li><li data-type='method'><a href="Collection.html#readRaw">readRaw</a></li><li data-type='method'><a href="Collection.html#remove">remove</a></li><li data-type='method'><a href="Collection.html#removeBulk">removeBulk</a></li><li data-type='method'><a href="Collection.html#search">search</a></li><li data-type='method'><a href="Collection.html#searchKeys">searchKeys</a></li><li data-type='method'><a href="Collection.html#select">select</a></li><li data-type='method'><a href="Collection.html#set">set</a></li><li data-type='method'><a href="Collection.html#setBulk">setBulk</a></li><li data-type='method'><a href="Collection.html#sha1">sha1</a></li><li data-type='method'><a href="Collection.html#write_raw">write_raw</a></li><li data-type='method'><a href="Collection.html#writeRaw">writeRaw</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="firestorm.html">firestorm</a><ul class='members'><li data-type='member'><a href="firestorm.html#.ID_FIELD">ID_FIELD</a></li></ul><ul class='methods'><li data-type='method'><a href="firestorm.html#.address">address</a></li><li data-type='method'><a href="firestorm.html#.collection">collection</a></li><li data-type='method'><a href="firestorm.html#.table">table</a></li><li data-type='method'><a href="firestorm.html#.token">token</a></li></ul></li><li><a href="firestorm.files.html">firestorm.files</a><ul class='methods'><li data-type='method'><a href="firestorm.files.html#.delete">delete</a></li><li data-type='method'><a href="firestorm.files.html#.get">get</a></li><li data-type='method'><a href="firestorm.files.html#.upload">upload</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
    
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><div align="center">
<img src="img/firestorm-128.png">
<h1>firestorm-db</h1>
<p><a href="https://www.npmjs.com/package/firestorm-db" target="_blank" ><img alt="npm" src="https://img.shields.io/npm/v/firestorm-db?color=cb0000&logo=npm&style=flat-square"></a>
<img alt="GitHub file size in bytes" src="https://img.shields.io/github/size/TheRolfFR/firestorm-db/src%2Findex.js?color=43A047&label=Script%20size&logoColor=green&style=flat-square">
<a href="https://github.com/TheRolfFR/firestorm-db/blob/main/CHANGELOG.md"> <img alt="Static Badge" src="https://img.shields.io/badge/Changelog-Read_here-blue?style=flat-square"></a>
<a href="https://github.com/TheRolfFR/firestorm-db/actions/workflows/testjs.yml"> <img src="https://img.shields.io/github/actions/workflow/status/TheRolfFR/firestorm-db/testjs.yml?style=flat-square
" alt="Tests" /></a></p>
</div>
<p><em>Self hosted Firestore-like database with API endpoints based on micro bulk operations</em></p>
<h2>Installation</h2>
<pre class="prettyprint source"><code>npm install --save firestorm-db
</code></pre>
<h2>JavaScript Part</h2>
<p>The JavaScript <a href="./src/index.js">index.js</a> file is just an <a href="https://www.npmjs.com/package/axios">Axios</a> wrapper of the library.</p>
<h2>How to use it</h2>
<p>First, you need to configure your API address, and your token if needed:</p>
<pre class="prettyprint source lang-js"><code>require(&quot;dotenv&quot;).config(); // add some env variables
const firestorm = require(&quot;firestorm-db&quot;);

// ex: 'http://example.com/path/to/firestorm/root/'
firestorm.address(process.env.FIRESTORM_URL);

// only necessary if you want to write or access private collections
// must match token stored in tokens.php file
firestorm.token(process.env.FIRESTORM_TOKEN);
</code></pre>
<p>Now you can use Firestorm to its full potential:</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);

// returns a Collection instance
const userCollection = firestorm.collection(&quot;users&quot;);

// all methods return promises
userCollection
    .readRaw()
    .then((res) => console.log(res))
    .catch((err) => console.error(err));
</code></pre>
<h3>Collection constructor</h3>
<p>A collection takes one required argument and one optional argument:</p>
<ul>
<li>The name of the collection as a <code>String</code>.</li>
<li>The method adder, which allows to inject methods to the get methods results. This would be a <code>Function</code> taking the element as an argument.</li>
</ul>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);

// returns a Collection instance
const userCollection = firestorm.collection(&quot;users&quot;, (el) => {
    el.hello = function () {
        console.log(`${el.name} says hello!`);
    };
});

// if you have a 'users' table with a printable field named name
const johnDoe = await userCollection.get(123456789);
// gives { name: &quot;John Doe&quot;, hello: function}

johnDoe.hello(); // prints out &quot;John Doe says hello!&quot;
</code></pre>
<p>Available methods for a collection:</p>
<h3>Read operations</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sha1()</td>
<td>none</td>
<td>Returns the file sha1 hash. May vary from read_raw because read_raw adds ID fields to the entries. Compare with stringify version of your file.</td>
</tr>
<tr>
<td>read_raw()</td>
<td>none</td>
<td>Reads the entire collection</td>
</tr>
<tr>
<td>get(id)</td>
<td>id: <code>String\|Name</code></td>
<td>Tries to get one element by its key</td>
</tr>
<tr>
<td>search(searchOptions, random)</td>
<td>searchOptions: <code>SearchOption[]</code> random?:<code>false\|true\|Number</code></td>
<td>Searches collections and returns matching results. <br>You can randomize the output order with random as true or a given seed.</td>
</tr>
<tr>
<td>searchKeys(keys)</td>
<td>keys: <code>String[] \| Number[]</code></td>
<td>Searches collections with given keys and returns matching results</td>
</tr>
<tr>
<td>select(selectOption)</td>
<td>selectOption: <code>{ field: String[] }</code></td>
<td>Improved read_raw with field selection</td>
</tr>
<tr>
<td>random(max, seed, offset)</td>
<td>max?: <code>Integer &gt;= -1</code> seed?: <code>Integer</code> offset?:<code>Integer &gt;= 0</code></td>
<td>Reads random entries of collection</td>
</tr>
</tbody>
</table>
<p>The search method can take one or more options to filter entries in a collection. A search option studies a <code>field</code> with a <code>criteria</code> and compares it to a <code>value</code>. You can also use the boolean <code>ignoreCase</code> option for string values.</p>
<p>Not all criteria are available depending the field type. There are more options available than the firestore <code>where</code> command, allowing you to get better and faster search results.</p>
<h3>All search options available</h3>
<table>
<thead>
<tr>
<th>Criteria</th>
<th>Types allowed</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'!='</code></td>
<td>Boolean, Number, String</td>
<td>Searches if the entry field's value is different from yours</td>
</tr>
<tr>
<td><code>'=='</code></td>
<td>Boolean, Number, String</td>
<td>Searches if the entry field's value is equal to yours</td>
</tr>
<tr>
<td><code>'&gt;='</code></td>
<td>Number, String</td>
<td>Searches if the entry field's value is greater or equal than yours</td>
</tr>
<tr>
<td><code>'&lt;='</code></td>
<td>Number, String</td>
<td>Searches if the entry field's value is equal to than yours</td>
</tr>
<tr>
<td><code>'&gt;'</code></td>
<td>Number, String</td>
<td>Searches if the entry field's value is greater than yours</td>
</tr>
<tr>
<td><code>'&lt;'</code></td>
<td>Number, String</td>
<td>Searches if the entry field's value is lower than yours</td>
</tr>
<tr>
<td><code>'in'</code></td>
<td>Number, String</td>
<td>Searches if the entry field's value is in the array of values you gave</td>
</tr>
<tr>
<td><code>'includes'</code></td>
<td>String</td>
<td>Searches if the entry field's value includes your substring</td>
</tr>
<tr>
<td><code>'startsWith'</code></td>
<td>String</td>
<td>Searches if the entry field's value starts with your substring</td>
</tr>
<tr>
<td><code>'endsWith'</code></td>
<td>String</td>
<td>Searches if the entry field's value ends with your substring</td>
</tr>
<tr>
<td><code>'array-contains'</code></td>
<td>Array</td>
<td>Searches if the entry field's array contains your value</td>
</tr>
<tr>
<td><code>'array-contains-any'</code></td>
<td>Array</td>
<td>Searches if the entry field's array ends contains your one value of more inside your values array</td>
</tr>
<tr>
<td><code>'array-length-eq'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is equal to your value</td>
</tr>
<tr>
<td><code>'array-length-df'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is different from your value</td>
</tr>
<tr>
<td><code>'array-length-lt'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is lower than your value</td>
</tr>
<tr>
<td><code>'array-length-gt'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is lower greater than your value</td>
</tr>
<tr>
<td><code>'array-length-le'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is lower or equal to your value</td>
</tr>
<tr>
<td><code>'array-length-ge'</code></td>
<td>Number</td>
<td>Searches if the entry field's array size is greater or equal to your value</td>
</tr>
</tbody>
</table>
<h3>Write operations</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>writes_raw()</td>
<td>none</td>
<td>Writes the entire collection <strong>/!\ Very dangerous /!\</strong></td>
</tr>
<tr>
<td>add(value)</td>
<td>value: <code>Object</code></td>
<td>Adds one element with autoKey into the collection</td>
</tr>
<tr>
<td>addBulk(values)</td>
<td>value: <code>Object[]</code></td>
<td>Adds multiple elements with autoKey into the collection</td>
</tr>
<tr>
<td>remove(key)</td>
<td>key: <code>String\|Name</code></td>
<td>Remove one element from the collection with the corresponding key</td>
</tr>
<tr>
<td>removeBulk(keys)</td>
<td>keys: <code>String[]\|Name[]</code></td>
<td>Remove multiple elements from the collection with the corresponding keys</td>
</tr>
<tr>
<td>set(key, value)</td>
<td>key: <code>String\|Name</code>, value: <code>Object</code></td>
<td>Sets one element with its key and value into the collection</td>
</tr>
<tr>
<td>setBulk(keys, values)</td>
<td>keys: <code>String[]\|Name[]</code>, values: <code>Object[]</code></td>
<td>Sets multiple elements with their corresponding keys and values into the collection</td>
</tr>
<tr>
<td>editField(obj)</td>
<td>obj: <code>EditObject</code></td>
<td>Changes one field of a given element in a collection</td>
</tr>
<tr>
<td>editFieldBulk(objArray)</td>
<td>objArray: <code>EditObject[]</code></td>
<td>Changes one field per element in a collection</td>
</tr>
</tbody>
</table>
<h3>Edit field operations</h3>
<p>Edit objects have an <code>id</code> to get the wanted element, a <code>field</code> they want to edit, an <code>operation</code> with what to do to this field, and a possible <code>value</code>. Here is a list of operations:</p>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Value required</th>
<th>Types allowed</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>set</code></td>
<td>Yes</td>
<td>any</td>
<td>Sets a field to a given value</td>
</tr>
<tr>
<td><code>remove</code></td>
<td>No</td>
<td>any</td>
<td>Removes a field from the element</td>
</tr>
<tr>
<td><code>append</code></td>
<td>Yes</td>
<td>String</td>
<td>Appends string at the end of the string field</td>
</tr>
<tr>
<td><code>invert</code></td>
<td>No</td>
<td>any</td>
<td>Inverts tate of boolean field</td>
</tr>
<tr>
<td><code>increment</code></td>
<td>No</td>
<td>Number</td>
<td>Adds a number to the field, default is 1</td>
</tr>
<tr>
<td><code>decrement</code></td>
<td>No</td>
<td>Number</td>
<td>Retrieves a number to the field, default is -1</td>
</tr>
<tr>
<td><code>array-push </code></td>
<td>Yes</td>
<td>any</td>
<td>Push an element to the end of an array field</td>
</tr>
<tr>
<td><code>array-delete</code></td>
<td>Yes</td>
<td>Integer</td>
<td>Removes and element at a certain index in an array field, check <a href="https://www.php.net/manual/function.array-splice">array_splice documentation</a> offset for more infos</td>
</tr>
<tr>
<td><code>array-splice</code></td>
<td>Yes</td>
<td>[Integer, Integer]</td>
<td>Removes certain elements, check <a href="https://www.php.net/manual/function.array-splice">array_splice documentation</a> offset and length for more infos</td>
</tr>
</tbody>
</table>
<br>
<h2>PHP files</h2>
<p>The PHP files are the ones handling files, read and writes. They also handle GET and POST requests to manipulate the database.</p>
<h2>PHP setup</h2>
<p>The developer has to create 2 files at the root of this folder: <code>tokens.php</code> and <code>config.php</code></p>
<p><code>tokens.php</code> will contain the tokens inside a <code>$db_tokens</code> value array with the tokens to use. You will use these tokens to write data or read private tables.</p>
<p><code>config.php</code> stores all of your collections config. You will create a <code>$database_list</code> variable with an array of <code>JSONDatabase</code> instances</p>
<pre class="prettyprint source lang-php"><code>&lt;?php
// config.php
require_once('./classes/JSONDatabase.php');

$database_list = array();

$tmp = new JSONDatabase;
$tmp->folderPath = './files/';
$tmp->fileName = 'users';
$tmp->autoKey = false;

$database_list[$tmp->fileName] = $tmp;

$tmp = new JSONDatabase;
$tmp->folderPath = './files/';
$tmp->fileName = 'paths';
$tmp->autoKey = true;

$database_list[$tmp->fileName] = $tmp;
?>
</code></pre>
<p>The database will be stored in <code>&lt;folderPath&gt;/&lt;filename&gt;.json</code> and <code>autoKey</code> allows or forbids some write operations.</p>
<h2>Files feature</h2>
<p>File API functions are detailed in the <code>files.php</code> PHP script. If you do not want to include this functionality, then just delete this file.</p>
<p>You have to add 2 new configuration variables to your <code>config.php</code> file:</p>
<pre class="prettyprint source lang-php"><code>// whitelist of correct extensions
$authorized_file_extension = array('.txt', '.png');

// subfolder of uploads location, must start with dirname($_SERVER['SCRIPT_FILENAME'])
// to force a subfolder of firestorm installation
$STORAGE_LOCATION = dirname($_SERVER['SCRIPT_FILENAME']) . '/uploads/';
</code></pre>
<p>You can use the wrapper functions in order to upload, get and delete a file.
If the folder is accessible from server url, you can directly type its address.</p>
<h3>File rights</h3>
<p>The PHP scripts create folders and files, so the script will fail if the PHP user doesn't have write permissions.
You can give rights to a folder with the following command:</p>
<pre class="prettyprint source"><code>sudo chown -R www-data &quot;/path/to/uploads/&quot;
</code></pre>
<h3>Upload a file</h3>
<p>In order to upload a file, you have to give the function a <code>FormData</code> object. This class is generated from forms and is <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData/FormData">native in modern browsers</a> but in Node.js can be imported with the <a href="https://www.npmjs.com/package/form-data">form-data package</a>.</p>
<p>The uploaded file content can be a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">String</a>, a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a>, a <a href="https://nodejs.org/api/buffer.html">Buffer</a> or an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a>.</p>
<p>There is additionally an overwrite option in order to avoid big mistakes and allow unique file names.</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);
firestorm.token(&quot;TOKEN_VALUE&quot;);

const form = new FormData();
form.append(&quot;path&quot;, &quot;/quote.txt&quot;);
form.append(&quot;file&quot;, &quot;but your kids are gonna love it.&quot;, &quot;quote.txt&quot;); // make sure to set a temporary name to the file
form.append(&quot;overwrite&quot;, &quot;true&quot;); // override optional argument (do not append to set to false)
const uploadPromise = firestorm.files.upload(form);

uploadPromise
    .then(() => {
        console.log(&quot;Upload successful&quot;);
    })
    .catch((err) => {
        consoler.error(err);
    });
</code></pre>
<h2>Get a file</h2>
<p>You can get a file via its direct file URL location or its content with a request.</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);

const getPromise = firestorm.files.get(&quot;/quote.txt&quot;);

getPromise
    .then((fileContent) => {
        console.log(fileContent); // 'but your kids are gonna love it.
    })
    .catch((err) => {
        console.error(err);
    });
</code></pre>
<h2>Delete a file</h2>
<p>Because I am a nice guy, I thought about deletion too. So I figured I would put a method to delete the files too.</p>
<pre class="prettyprint source lang-js"><code>const firestorm = require(&quot;firestorm-db&quot;);
firestorm.address(&quot;ADDRESS_VALUE&quot;);
firestorm.token(&quot;TOKEN_VALUE&quot;);

const deletePromise = firestorm.files.delete(&quot;/quote.txt&quot;);

deletePromise
    .then(() => {
        console.log(&quot;File successfully deleted&quot;);
    })
    .catch((err) => {
        console.error(err);
    });
</code></pre>
<h2>Memory warning</h2>
<p>Handling big collections can cause memory allocation issues like:</p>
<pre class="prettyprint source"><code>Fatal error:
Allowed memory size of 134217728 bytes exhausted (tried to allocate 32360168 bytes)
</code></pre>
<p>If you encounter a memory allocation issue, you have to allow more memory through this file <code>/etc/php/7.4/apache2/php.ini</code> with a bigger value here:</p>
<pre class="prettyprint source"><code>memory_limit = 256M
</code></pre>
<h2>API endpoints</h2>
<p>All Firestorm methods correspond to an equivalent Axios request. Read requests are GET request and write requests are POST requests with provided JSON data.</p>
<p>You always have the same first keys and the one key per method:</p>
<pre class="prettyprint source lang-json"><code>{
  &quot;collection&quot;: &quot;&lt;collectionName>&quot;,
  &quot;token&quot;: &quot;&lt;writeTokenIfNecessary>&quot;,
  &quot;command&quot;: &quot;&lt;methodName>&quot;,
  ...
}
</code></pre></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Dec 17 2023 14:07:04 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>